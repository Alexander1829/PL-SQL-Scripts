ALTER TABLE MOBILE.EXCEPTIONS_APP
 DROP PRIMARY KEY CASCADE;

DROP TABLE MOBILE.EXCEPTIONS_APP CASCADE CONSTRAINTS;

CREATE TABLE MOBILE.EXCEPTIONS_APP
(
  ID             NUMBER,
  MESSAGE        VARCHAR2(4000 BYTE),
  API_PATH       NVARCHAR2(40),
  API_QUERY      NVARCHAR2(1000),
  API_BODY       VARCHAR2(4000 BYTE),
  USER_CRITICAL  NUMBER(1),
  REAL_LOGIN     NVARCHAR2(104),
  TOKEN          NVARCHAR2(2000),
  DATE_LOG       TIMESTAMP(6)                   DEFAULT CURRENT_TIMESTAMP
)
TABLESPACE MOBILE_TBS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
MONITORING;


CREATE UNIQUE INDEX MOBILE.EXCEPTIONS_APP_PK ON MOBILE.EXCEPTIONS_APP
(ID)
LOGGING
TABLESPACE MOBILE_TBS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

CREATE OR REPLACE TRIGGER MOBILE.EXCEPTIONS_APP_BIR 
BEFORE INSERT ON MOBILE.EXCEPTIONS_APP 
FOR EACH ROW
BEGIN
  SELECT SEQ_EXCEPTIONS_APP.NEXTVAL
  INTO   :new.id
  FROM   dual;
END;
/


ALTER TABLE MOBILE.EXCEPTIONS_APP ADD (
  CONSTRAINT EXCEPTIONS_APP_PK
  PRIMARY KEY
  (ID)
  USING INDEX MOBILE.EXCEPTIONS_APP_PK
  ENABLE VALIDATE);
-------------------------------------------
DROP TABLE MOBILE.USER_ACTIVITY_LOG CASCADE CONSTRAINTS;

CREATE TABLE MOBILE.USER_ACTIVITY_LOG
(
  API_PATH   VARCHAR2(200 BYTE),
  API_QUERY  VARCHAR2(200 BYTE),
  API_BODY   VARCHAR2(4000 BYTE),
  DATE_LOG   TIMESTAMP(6)                       DEFAULT CURRENT_TIMESTAMP,
  LOGIN      NVARCHAR2(100),
  TOKEN      NVARCHAR2(2000)
)
TABLESPACE MOBILE_TBS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
MONITORING;
------------------------------------

DROP TABLE MOBILE.CS_SLICE CASCADE CONSTRAINTS;

CREATE TABLE MOBILE.CS_SLICE
(
  ID          NUMBER                            NOT NULL,
  DATE_BEGIN  DATE                              NOT NULL,
  DATE_END    DATE                              NOT NULL,
  POINTCODE   VARCHAR2(11 CHAR)                 NOT NULL,
  DELETED     INTEGER                           DEFAULT 0,
  DATE_SEND   DATE
)
TABLESPACE MOBILE_TBS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
MONITORING;

COMMENT ON TABLE MOBILE.CS_SLICE IS 'Список конкурентных срезов';


CREATE UNIQUE INDEX MOBILE.CS_SLICE_PK ON MOBILE.CS_SLICE
(ID)
LOGGING
TABLESPACE MOBILE_TBS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

CREATE OR REPLACE TRIGGER MOBILE.CS_SLICE_BIR 
BEFORE INSERT ON "MOBILE"."CS_SLICE" 
FOR EACH ROW
BEGIN
  SELECT SEQ_CS_SLICE.NEXTVAL
  INTO   :new.ID
  FROM   dual;
END;
/
-------------------------------------------

DROP TABLE MOBILE.CS_SLICE_PR CASCADE CONSTRAINTS;

CREATE TABLE MOBILE.CS_SLICE_PR
(
  ID                    NUMBER                  NOT NULL,
  SLICE_ID              NUMBER                  NOT NULL,
  COMPETITOR_NAME_ID    INTEGER                 NOT NULL,
  COMPETITOR_STATUS_ID  INTEGER                 NOT NULL,
  DISTANCE_ID           INTEGER                 NOT NULL,
  GEO_ZONE_ID           INTEGER                 NOT NULL,
  TERR_SHAPE_ID         INTEGER                 NOT NULL,
  JUR_ID                INTEGER                 NOT NULL,
  COMPETITOR_ADDRESS    VARCHAR2(2000 BYTE)     NOT NULL,
  DATE_MODIFY           DATE                    DEFAULT sysdate               NOT NULL,
  MODIFIER_TAB_NUM      VARCHAR2(10 CHAR)       NOT NULL,
  IS_INCORRECT          INTEGER                 DEFAULT 0
)
TABLESPACE MOBILE_TBS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
MONITORING;

COMMENT ON TABLE MOBILE.CS_SLICE_PR IS 'Записи ответственного точки о конкурентах точки, в конкурентном срезе';


CREATE UNIQUE INDEX MOBILE.COMPET_SLICE_ACCOUNTS_PK ON MOBILE.CS_SLICE_PR
(ID)
LOGGING
TABLESPACE MOBILE_TBS
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           );

CREATE OR REPLACE TRIGGER MOBILE.COMPET_SLICE_ACCOUNTS_BIR 
BEFORE INSERT ON "MOBILE"."CS_SLICE_PR" 
FOR EACH ROW
BEGIN
  SELECT SEQ_COMPET_SLICE_ACCOUNTS.NEXTVAL
  INTO   :new.ID
  FROM   dual;
END;
/
---------------------------------
