DROP MATERIALIZED VIEW MOBILE.MW_POMAKSA_BRAND_TO_SHOW;

CREATE MATERIALIZED VIEW MOBILE.MW_POMAKSA_BRAND_TO_SHOW 
    (BRAND,PLACE,BRAND_SHOW)
TABLESPACE MOBILE_TBS
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCACHE
NOLOGGING
NOCOMPRESS
BUILD IMMEDIATE
REFRESH COMPLETE ON DEMAND
WITH PRIMARY KEY
AS 
SELECT brand,
       NVL (place, 100)
           place,
       CASE WHEN place IS NULL THEN 'Другое' ELSE brand END
           AS brand_show
  FROM (  SELECT p.brand, o.place
            FROM (SELECT DISTINCT d001_brand     brand
                    FROM DWH.D001_ITEM
                   WHERE     D001_KIND = 'Товар'
                         AND D001_TYPE = 'Товар'
                         AND (   D001_SUBGROUP = 'Смартфон'
                              OR D001_SUBGROUP = 'Не смартфон')) p
                 LEFT JOIN mobile_access.pomaksa_brand_order o
                     ON p.brand = o.brand
        ORDER BY place, brand);


COMMENT ON MATERIALIZED VIEW MOBILE.MW_POMAKSA_BRAND_TO_SHOW IS 'snapshot table for snapshot MOBILE.MW_POMAKSA_BRAND_TO_SHOW';
CREATE OR REPLACE SYNONYM MOBILE_ACCESS.MW_POMAKSA_BRAND_TO_SHOW FOR MOBILE.MW_POMAKSA_BRAND_TO_SHOW;
GRANT SELECT ON MOBILE.MW_POMAKSA_BRAND_TO_SHOW TO MOBILE_ACCESS;
